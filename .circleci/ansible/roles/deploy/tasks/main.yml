---

- name: Copy files
  become: true
  copy:
    src: /root/project/artifact.tar.gz
    dest: /home/ubuntu/artifact.tar.gz
- name: Unarchive
  become: true
  shell : |
      cd /home/ubuntu/
      tar xvzf artifact.tar.gz -C .
- name: "run server"
  become: true
  shell : |
      cd /home/ubuntu/
      npm install
      pm2 stop default
      pm2 start npm -- start
# - name: Upgrade npm
#   become: true
#   shell: |
#     npm install -g npm@latest

# - name: Copy compiled files
#   unarchive:
#     src: /root/project/backend.tar.gz
#     dest: /home/ubuntu/

# - name: Build backend
#   ignore_errors: yes
#   shell: |
#     cd /home/ubuntu/backend
#     npm i
#     npm run build

# - name: Stop and delete already running server
#   ignore_errors: yes
#   shell: |
#     pm2 stop backend
#     pm2 delete backend

# - name: Start server
#   become: true
#   shell: |
#     cd /home/ubuntu/backend
#     pm2 start npm --name backend -- start
#     pm2 ls
